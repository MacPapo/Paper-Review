{% extends 'base.html' %}
{% from "projects_components/_projects_accordion.html" import render_status_bedge %}
{% from "projects_components/_project_info.html" import render_info, render_pdfs, render_user, render_user_for_comments %}
{% from "form_components/_render_field.html" import render_field, render_submit_button %}

{% block content %}
<section class="py-4 py-md-5 my-5">
    <div class="container py-md-5">
        {{ render_info(project.versions[version_number - 1]) }}

        <hr class="hr" />
        <br>
        
        {{ render_pdfs(get_pdf_lambda(project.versions[version_number - 1].contains)) }}

        <!-- For Spacing -->
        <div class="mx-auto" style="height: 125px;"></div>

        <h1 class="modal-title fs-5" id="exampleModalLabel">Comments</h1>
        <br>

        {% for comment in comments %}
        <div>
            {{ render_user_for_comments(comment.user, comment, version_number, comment.version_ref) }}

            {{ comment.body }}
            
            {% if not loop.last %}
                <hr>
            {% endif %}
        </div>
    {% endfor %}

       <!-- For Spacing -->
       <div class="mx-auto" style="height: 75px;"></div>
    

        <form method="POST" enctype="multipart/form-data" class="needs-validation" novalidate>
          {{ form.hidden_tag() }}
         
          <div class="form-group mb-4">
              {{ form.body(class="form-control", placeholder="Write a comment", rows="7", required=True) }}
          </div>
          {{ form.submit(class="btn btn-primary") }}
      </form>
        
    </div>
</section>
{% endblock %}

{% block scripts %}
{{ super() }}
<script type="text/javascript">
const myModal = document.getElementById('myModal')
const myInput = document.getElementById('myInput')

myModal.addEventListener('shown.bs.modal', () => {
  myInput.focus()
})
</script>
<script type="text/javascript">
 var pid = {{ project.pid }};
 $('#b1').click(function(e){
     e.preventDefault();
     var n = 1;
  $.ajax({
    url: `/project/${pid}/report_list/${n}`,
    type: 'GET',
    success: function(data) {
      var reports = data; // Extract the reports from the returned data
      var reportList = $('#report-list');
      reportList.empty(); // Clear the existing list

      // Iterate over the reports and create the list of links
      for (var i = 0; i < reports.length; i++) {
        var report = reports[i];
        var url = `/project/${report.pid}/report/${report.rid}/${report.rvid}`;
        var link = $('<a>').attr('href', url).text(report.title);
        var listItem = $('<li>').append(link);
        reportList.append(listItem);
      }
      console.log(data); // Log the data to the console for testing
    },
    error: function(error) {
      console.log(error); // Log any errors to the console
    }
  });
});




$('#b2').click(function(e){
     e.preventDefault();
     var n = 2;
  $.ajax({
    url: `/project/${pid}/report_list/${n}`,
    type: 'GET',
    success: function(data) {
      var reports = data; // Extract the reports from the returned data
      var reportList = $('#report-list');
      reportList.empty(); // Clear the existing list

      // Iterate over the reports and create the list of links
      for (var i = 0; i < reports.length; i++) {
        var report = reports[i];
        var url = `/project/${report.pid}/report/${report.rid}/${report.rvid}`;
        var link = $('<a>').attr('href', url).text(report.title);
        var listItem = $('<li>').append(link);
        reportList.append(listItem);
      }
      console.log(data); // Log the data to the console for testing
    },
    error: function(error) {
      console.log(error); // Log any errors to the console
    }
  });
});




$('#b3').click(function(e){
     e.preventDefault();
     var n = 3;
  $.ajax({
    url: `/project/${pid}/report_list/${n}`,
    type: 'GET',
    success: function(data) {
      var reports = data; // Extract the reports from the returned data
      var reportList = $('#report-list');
      reportList.empty(); // Clear the existing list

      // Iterate over the reports and create the list of links
      for (var i = 0; i < reports.length; i++) {
        var report = reports[i];
        var url = `/project/${report.pid}/report/${report.rid}/${report.rvid}`;
        var link = $('<a>').attr('href', url).text(report.title);
        var listItem = $('<li>').append(link);
        reportList.append(listItem);
      }
      console.log(data); // Log the data to the console for testing
    },
    error: function(error) {
      console.log(error); // Log any errors to the console
    }
  });
});




 $('#b4').click(function(e){
     e.preventDefault();
     var n = 4;
  $.ajax({
    url: `/project/${pid}/report_list/${n}`,
    type: 'GET',
    success: function(data) {
      var reports = data; // Extract the reports from the returned data
      var reportList = $('#report-list');
      reportList.empty(); // Clear the existing list

      // Iterate over the reports and create the list of links
      for (var i = 0; i < reports.length; i++) {
        var report = reports[i];
        var url = `/project/${report.pid}/report/${report.rid}/${report.rvid}`;
        var link = $('<a>').attr('href', url).text(report.title);
        var listItem = $('<li>').append(link);
        reportList.append(listItem);
      }
      console.log(data); // Log the data to the console for testing
    },
    error: function(error) {
      console.log(error); // Log any errors to the console
    }
  });
});

</script>
{% endblock %}
